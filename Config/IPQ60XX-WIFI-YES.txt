# --- 1. 基础架构与设备定义 ---
CONFIG_TARGET_qualcommax=y
CONFIG_TARGET_qualcommax_ipq60xx=y
CONFIG_TARGET_MULTI_PROFILE=y
CONFIG_TARGET_PER_DEVICE_ROOTFS=y
CONFIG_TARGET_DEVICE_qualcommax_ipq60xx_DEVICE_jdcloud_re-ss-01=y
# 注意：移除了 zram-swap，因为1GB内存不需要
CONFIG_TARGET_DEVICE_PACKAGES_qualcommax_ipq60xx_DEVICE_jdcloud_re-ss-01="ipq-wifi-jdcloud_re-ss-01"

# --- 2. 1G内存硬改专项优化 (内核级) ---
CONFIG_IPQ_MEM_PROFILE_1024=y
CONFIG_KERNEL_IPQ_MEM_PROFILE=1024
CONFIG_ATH11K_MEM_PROFILE_1024M=y
CONFIG_KERNEL_TRANSPARENT_HUGEPAGE=y
CONFIG_KERNEL_TRANSPARENT_HUGEPAGE_MADVISE=y
CONFIG_KERNEL_SKB_RECYCLER=y
CONFIG_KERNEL_SKB_RECYCLER_MULTI_CPU=y
# 禁用抢占，确保NSS fast-path时序稳定
# CONFIG_KERNEL_PREEMPT is not set
CONFIG_KERNEL_PREEMPT_NONE=y
CONFIG_KERNEL_HIGH_RES_TIMERS=y

# 禁用内核zram支持，节省内核空间
# CONFIG_KERNEL_ZRAM is not set

# --- 3. 编译与语言优化 (架构相关部分) ---
CONFIG_TARGET_OPTIONS=y
# 稳定优先，使用-O2优化级别
CONFIG_TARGET_OPTIMIZATION="-O2 -pipe -march=armv8-a+crypto+crc -mcpu=cortex-a53+crypto+crc -mtune=cortex-a53"

# --- 4. NSS硬件加速全开 (IPQ60XX专用) ---
# 版本选择：12.5稳定版
CONFIG_NSS_FIRMWARE_VERSION_12_5=y
# 基础功能：IGS、L2TP、SHAPER
CONFIG_NSS_DRV_IGS_ENABLE=y
CONFIG_NSS_DRV_L2TP_ENABLE=y
CONFIG_NSS_DRV_SHAPER_ENABLE=y
# 移除单WAN设备不用的LAG功能
# CONFIG_NSS_DRV_LAG_ENABLE is not set

# NSS核心驱动
CONFIG_PACKAGE_kmod-qca-nss-dp=y
CONFIG_PACKAGE_kmod-qca-ssdk=y
CONFIG_PACKAGE_kmod-qca-ssdk-hnat=y
CONFIG_PACKAGE_kmod-qca-nss-drv=y
CONFIG_PACKAGE_kmod-qca-nss-drv-igs=y
CONFIG_PACKAGE_kmod-qca-nss-drv-l2tpv2=y
# CONFIG_PACKAGE_kmod-qca-nss-drv-lag-mgr is not set
CONFIG_PACKAGE_kmod-qca-nss-drv-pppoe=y
CONFIG_PACKAGE_kmod-qca-nss-drv-qdisc=y
CONFIG_PACKAGE_kmod-qca-nss-drv-bridge-mgr=y
CONFIG_PACKAGE_kmod-qca-nss-ecm=y
CONFIG_PACKAGE_kmod-qca-mcs=y
CONFIG_PACKAGE_sqm-scripts-nss=y

# NSS监控调试工具（IPQ60XX专用）
CONFIG_PACKAGE_nss-utils=y
CONFIG_PACKAGE_qca-nss-clients=y
CONFIG_PACKAGE_qca-ssdk-shell=y

# --- 5. 无线驱动 (IPQ60XX专用) ---
# 使用标准IPQ60xx firmware，避免实验性EHT特性
CONFIG_PACKAGE_ath11k-firmware-ipq60xx=y
# 如果特定型号需要，可以添加备用
# CONFIG_PACKAGE_ath11k-firmware-qca6018=y

CONFIG_PACKAGE_kmod-ath11k=y
CONFIG_PACKAGE_kmod-ath11k-pci=y
# WiFi诊断工具（IPQ专用）
CONFIG_PACKAGE_iw-full=y
CONFIG_PACKAGE_iwinfo=y
CONFIG_PACKAGE_hostapd-utils=y

# --- 6. 温度监控 (IPQ60XX硬件监控) ---
CONFIG_PACKAGE_kmod-thermal=y
CONFIG_PACKAGE_kmod-thermal-tsens=y
CONFIG_PACKAGE_kmod-qca-thermal=y
CONFIG_PACKAGE_lm-sensors=y
CONFIG_PACKAGE_sensors=y
CONFIG_PACKAGE_sensord=y

# --- 7. USB支持 (IPQ6018精准匹配 - 控制器层) ---
# IPQ6018硬件：DWC3 + xHCI，无EHCI/OHCI/UHCI/DWC2
CONFIG_PACKAGE_kmod-usb-core=y
CONFIG_PACKAGE_kmod-usb-dwc3=y
CONFIG_PACKAGE_kmod-usb-dwc3-qcom=y
CONFIG_PACKAGE_kmod-usb-xhci=y
CONFIG_PACKAGE_kmod-usb3=y
CONFIG_PACKAGE_kmod-usb-phy-qcom-dwc3=y
CONFIG_PACKAGE_kmod-usb-roles=y
CONFIG_PACKAGE_kmod-usb-phy-nop=y

# --- 8. 网络优化 (IPQ60XX专用内核参数) ---
CONFIG_DEFAULT_TCP_CONG="bbr"
CONFIG_KERNEL_TCP_CONG_BBR=y
CONFIG_KERNEL_TCP_MD5SIG=y
CONFIG_KERNEL_IPV6_SEG6_LWTUNNEL=y
CONFIG_KERNEL_NET_IP_TUNE=y
CONFIG_KERNEL_NET_SCH_FQ=y
CONFIG_KERNEL_NET_SCH_FQ_CODEL=y
# 针对1GB内存调整网络栈参数
CONFIG_KERNEL_NET_IPV4_TCP_MEM="1536 2048 3072"
CONFIG_KERNEL_NET_IPV4_UDPLITE_MEM="512 1024 1536"

# --- 9. 禁用与精简 (IPQ60XX内核部分) ---
# CONFIG_KERNEL_DEBUG_INFO is not set
# CONFIG_KERNEL_DEBUG_KERNEL is not set
# CONFIG_TARGET_ROOTFS_INITRAMFS is not set
CONFIG_TARGET_ROOTFS_INITRAMFS=n

# --- 10. 硬件相关文件系统 (NAND/eMMC优化) ---
CONFIG_PACKAGE_kmod-mtd=y
CONFIG_PACKAGE_kmod-mtd-rw=y
CONFIG_PACKAGE_kmod-nand=y
CONFIG_PACKAGE_kmod-nand-raw=y
CONFIG_PACKAGE_kmod-spi-nor=y
CONFIG_PACKAGE_kmod-fs-ubifs=y
CONFIG_PACKAGE_uboot-envtools=y

# --- 11. 内存监控工具 ---
CONFIG_PACKAGE_procps-ng=y
CONFIG_PACKAGE_procps-ng-free=y
CONFIG_PACKAGE_procps-ng-top=y
CONFIG_PACKAGE_procps-ng-w=y
