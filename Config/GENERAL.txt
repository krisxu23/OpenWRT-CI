# --- 1. 编译与语言优化 (通用部分) ---
CONFIG_DEVEL=y
CONFIG_CCACHE=y
CONFIG_LUCI_LANG_zh_Hans=y
CONFIG_PACKAGE_default-settings=y
CONFIG_PACKAGE_default-settings-chn=y

# --- 2. 通用无线驱动 (用户态组件) ---
CONFIG_PACKAGE_wpad-openssl=y
# 通用无线工具
CONFIG_PACKAGE_iw=y
CONFIG_PACKAGE_iwinfo=y

# --- 3. USB支持 (通用外设层) ---
# USB存储
CONFIG_PACKAGE_kmod-usb-storage=y
CONFIG_PACKAGE_kmod-usb-storage-uas=y
CONFIG_PACKAGE_kmod-usb-storage-extras=y
CONFIG_PACKAGE_kmod-scsi-core=y

# USB网络共享 (全面覆盖各平台)
CONFIG_PACKAGE_kmod-usb-net=y
CONFIG_PACKAGE_kmod-usb-net-rndis=y          # Windows USB共享
CONFIG_PACKAGE_kmod-usb-net-ipheth=y         # iPhone USB共享
CONFIG_PACKAGE_kmod-usb-net-cdc-ether=y      # Android/Linux USB共享
CONFIG_PACKAGE_kmod-usb-net-cdc-ncm=y        # 现代Android
CONFIG_PACKAGE_kmod-usb-net-cdc-mbim=y       # 4G/5G模块
CONFIG_PACKAGE_kmod-usb-net-qmi-wwan=y       # QMI协议
CONFIG_PACKAGE_kmod-usb-net-asix-ax88179=y   # 千兆USB网卡
CONFIG_PACKAGE_kmod-usb-net-rtl8152=y        # 常见USB网卡
CONFIG_PACKAGE_kmod-usb-net-huawei-cdc-ncm=y # 华为设备
CONFIG_PACKAGE_kmod-usb-net-qmi-wwan-quectel=y # 移远模块

# USB串口 (调试备用)
CONFIG_PACKAGE_kmod-usb-serial=y
CONFIG_PACKAGE_kmod-usb-serial-qualcomm=y
CONFIG_PACKAGE_kmod-usb-acm=y

# 字符集支持
CONFIG_PACKAGE_kmod-nls-base=y
CONFIG_PACKAGE_kmod-nls-utf8=y
CONFIG_PACKAGE_kmod-nls-cp437=y
CONFIG_PACKAGE_kmod-nls-iso8859-1=y

# --- 4. ZRAM优化 (针对1GB内存设备：禁用) ---
# 完全禁用zram相关包和模块
CONFIG_PACKAGE_zram-swap=n
CONFIG_PACKAGE_kmod-zram=n
# CONFIG_KERNEL_ZRAM_DEF_COMP_LZ4 is not set
# CONFIG_KERNEL_ZRAM_BACKEND_LZ4 is not set

# --- 5. 磁盘管理与文件系统 ---
CONFIG_PACKAGE_fdisk=y
CONFIG_PACKAGE_lsblk=y
CONFIG_PACKAGE_block-mount=y
CONFIG_PACKAGE_automount=y
CONFIG_PACKAGE_luci-app-diskman=y

# 文件系统支持
CONFIG_PACKAGE_kmod-fs-ext4=y          # 主系统
CONFIG_PACKAGE_kmod-fs-exfat=y         # U盘通用
CONFIG_PACKAGE_kmod-fs-ntfs3=y         # Windows磁盘 (高性能首选)
CONFIG_PACKAGE_kmod-fs-vfat=y          # 旧U盘兼容
CONFIG_PACKAGE_kmod-fs-f2fs=y          # eMMC优化
# CONFIG_PACKAGE_kmod-fs-xfs is not set
# CONFIG_PACKAGE_kmod-fs-btrfs is not set

CONFIG_PACKAGE_e2fsprogs=y
CONFIG_PACKAGE_fstrim=y
CONFIG_PACKAGE_blkid=y

# --- 6. Docker内核最小完整集 ---
# 命名空间
CONFIG_PACKAGE_kmod-namespaces=y
# Cgroups
CONFIG_PACKAGE_kmod-cgroup-core=y
CONFIG_PACKAGE_kmod-cgroup-pids=y
CONFIG_PACKAGE_kmod-cgroup-device=y
CONFIG_PACKAGE_kmod-cgroup-freezer=y
# 可选cgroup（按需开启）
# CONFIG_PACKAGE_kmod-cgroup-cpuset=y
# CONFIG_PACKAGE_kmod-cgroup-hugetlb=y
# 文件系统与网络
CONFIG_PACKAGE_kmod-fs-overlayfs=y
CONFIG_PACKAGE_kmod-fuse=y
CONFIG_PACKAGE_kmod-bridge=y
CONFIG_PACKAGE_kmod-veth=y
CONFIG_PACKAGE_kmod-nf-nat=y
CONFIG_PACKAGE_kmod-nf-conntrack=y
# 注意：以下iptables模块已移除，用nftables替代
# CONFIG_PACKAGE_kmod-ipt-conntrack is not set
# CONFIG_PACKAGE_kmod-ipt-nat is not set
# 其他必要
CONFIG_PACKAGE_kmod-dummy=y
CONFIG_PACKAGE_kmod-macvlan=y

# --- 7. 网络协议与防火墙 (纯nftables路线) ---
# 基础协议
CONFIG_PACKAGE_kmod-bonding=y
CONFIG_PACKAGE_proto-bonding=y
CONFIG_PACKAGE_kmod-gre=y
CONFIG_PACKAGE_kmod-gre6=y
CONFIG_PACKAGE_kmod-sit=y
CONFIG_PACKAGE_kmod-tun=y
CONFIG_PACKAGE_kmod-wireguard=y
CONFIG_PACKAGE_luci-proto-wireguard=y

# 加密模块 (nftables需要)
CONFIG_PACKAGE_kmod-crypto-acompress=y
CONFIG_PACKAGE_kmod-crypto-crc32=y
CONFIG_PACKAGE_kmod-crypto-lib-chacha20=y
CONFIG_PACKAGE_kmod-crypto-lib-chacha20poly1305=y
CONFIG_PACKAGE_kmod-crypto-lib-curve25519=y
CONFIG_PACKAGE_kmod-crypto-lib-poly1305=y

# 压缩库
CONFIG_PACKAGE_kmod-lib-lzo=y
CONFIG_PACKAGE_kmod-lib-zstd=y

# ===== 纯 nftables 防火墙核心 =====
# 完全禁用 iptables 相关包
# CONFIG_PACKAGE_iptables is not set
# CONFIG_PACKAGE_iptables-nft is not set
# CONFIG_PACKAGE_ip6tables is not set
# CONFIG_PACKAGE_ip6tables-nft is not set
# CONFIG_PACKAGE_kmod-ipt-core is not set
# CONFIG_PACKAGE_kmod-ipt-conntrack is not set
# CONFIG_PACKAGE_kmod-ipt-nat is not set
# CONFIG_PACKAGE_kmod-ipt-fullconenat is not set
# CONFIG_PACKAGE_kmod-nft-compat is not set  # 不需要iptables兼容层

# nftables 核心包
CONFIG_PACKAGE_firewall4=y                    # nftables防火墙前端
CONFIG_PACKAGE_nftables=y                     # nftables命令行工具
CONFIG_PACKAGE_nftables-json=y                # JSON支持
CONFIG_PACKAGE_nftables-nojson=n              # 确保不使用无JSON版本

# nftables 内核模块（完整集）
CONFIG_PACKAGE_kmod-nft-core=y                # 核心模块
CONFIG_PACKAGE_kmod-nft-nat=y                 # NAT功能
CONFIG_PACKAGE_kmod-nft-fullcone=y            # FullCone NAT（替代iptables-fullconenat）
CONFIG_PACKAGE_kmod-nft-connlimit=y           # 连接限制
CONFIG_PACKAGE_kmod-nft-bridge=y              # 桥接过滤
CONFIG_PACKAGE_kmod-nft-netdev=y              # 网络设备过滤
CONFIG_PACKAGE_kmod-nft-tproxy=y              # 透明代理
CONFIG_PACKAGE_kmod-nft-offload=y             # 硬件卸载（对NSS很重要）
CONFIG_PACKAGE_kmod-nft-queue=y               # 数据包队列
CONFIG_PACKAGE_kmod-nft-xfrm=y                # IPsec支持
CONFIG_PACKAGE_kmod-nft-arp=y                 # ARP过滤
CONFIG_PACKAGE_kmod-nft-socket=y              # 套接字匹配
CONFIG_PACKAGE_kmod-nft-dup-inet=y            # 重复包检测
CONFIG_PACKAGE_kmod-nft-fib=y                 # 路由查找
CONFIG_PACKAGE_kmod-nft-hash=y                # 哈希表支持

# 网络连接跟踪（nftables版本）
CONFIG_PACKAGE_kmod-nft-conntrack=y           # nftables连接跟踪
CONFIG_PACKAGE_kmod-nf-conntrack=y            # 通用连接跟踪
CONFIG_PACKAGE_kmod-nf-nat=y                  # 通用NAT

# 网络诊断
CONFIG_PACKAGE_kmod-inet-diag=y
CONFIG_PACKAGE_kmod-netlink-diag=y

# --- 8. 核心工具 ---
CONFIG_PACKAGE_htop=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_tcping=y
CONFIG_PACKAGE_iperf3=y
CONFIG_PACKAGE_unzip=y
CONFIG_PACKAGE_ca-bundle=y
CONFIG_PACKAGE_zoneinfo-asia=y
CONFIG_PACKAGE_openssh-sftp-server=y
CONFIG_PACKAGE_openssh-keygen=y
CONFIG_PACKAGE_openssl-util=y

# 网络诊断工具（nftables兼容）
CONFIG_PACKAGE_mtr=y
CONFIG_PACKAGE_ethtool=y
CONFIG_PACKAGE_tcpdump=y                      # 完整版本支持nftables
CONFIG_PACKAGE_nmap=y

# 内存监控工具
CONFIG_PACKAGE_free=y
CONFIG_PACKAGE_vmstat=y

# nftables专用工具
CONFIG_PACKAGE_nft-qos=y                      # nftables QoS扩展

# --- 9. LuCI核心与应用 ---
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-base=y
CONFIG_PACKAGE_luci-compat=y
CONFIG_PACKAGE_luci-lib-base=y
CONFIG_PACKAGE_luci-lib-ipkg=y
CONFIG_PACKAGE_luci-mod-admin-full=y
CONFIG_PACKAGE_luci-mod-network=y
CONFIG_PACKAGE_luci-mod-status=y
CONFIG_PACKAGE_luci-mod-system=y
CONFIG_PACKAGE_rpcd-mod-luci=y

# 主题
CONFIG_PACKAGE_luci-theme-argon=y
CONFIG_PACKAGE_luci-app-argon-config=y
CONFIG_PACKAGE_luci-theme-bootstrap=y

# 基础应用（使用nftables版本）
CONFIG_PACKAGE_luci-app-firewall=y        
CONFIG_PACKAGE_luci-app-ttyd=y
CONFIG_PACKAGE_luci-app-autoreboot=y
CONFIG_PACKAGE_luci-app-sqm=y
CONFIG_PACKAGE_luci-app-mosdns=y
CONFIG_PACKAGE_luci-app-adguardhome=y

# 系统监控
CONFIG_PACKAGE_luci-app-statistics=y
CONFIG_PACKAGE_collectd=y
CONFIG_PACKAGE_collectd-mod-cpu=y
CONFIG_PACKAGE_collectd-mod-interface=y
CONFIG_PACKAGE_collectd-mod-memory=y
CONFIG_PACKAGE_collectd-mod-network=y
CONFIG_PACKAGE_collectd-mod-ping=y

# 科学上网 (homeproxy + sing-box全功能)
CONFIG_PACKAGE_luci-app-homeproxy=y
CONFIG_PACKAGE_sing-box=y
CONFIG_SING_BOX_BUILD_WIREGUARD=y
CONFIG_SING_BOX_BUILD_QUIC=y
CONFIG_SING_BOX_BUILD_ECH=y
CONFIG_SING_BOX_BUILD_UTLS=y
CONFIG_SING_BOX_BUILD_ACME=y
CONFIG_SING_BOX_BUILD_REALITY_SERVER=y
CONFIG_SING_BOX_BUILD_CLASH_API=y

# --- 10. 编译选项 (Busybox) ---
CONFIG_BUSYBOX_CUSTOM=y
CONFIG_BUSYBOX_CONFIG_TELNET=y
CONFIG_BUSYBOX_CONFIG_LSUSB=y
CONFIG_BUSYBOX_CONFIG_FEATURE_TOP_SMP_CPU=y
CONFIG_BUSYBOX_CONFIG_FEATURE_TOP_SMP_PROCESS=y

# --- 11. 安全与证书 ---
CONFIG_PACKAGE_ca-certificates=y
CONFIG_OPENSSL_OPTION_SPEED=y
CONFIG_OPENSSL_WITH_ASM=y

# --- 12. IPv6完整支持 (nftables版本) ---
CONFIG_PACKAGE_odhcp6c=y
CONFIG_PACKAGE_odhcpd-ipv6only=y
CONFIG_PACKAGE_dnsmasq-full=y
CONFIG_DNSMASQ_FULL_CONNTRACK=y
CONFIG_DNSMASQ_FULL_DNSSEC=y
CONFIG_DNSMASQ_FULL_IPSET=y
# IPv6防火墙由nftables统一处理，不需要单独的ip6tables

# --- 13. 内核配置（确保nftables支持） ---
# 这些通常在目标配置中设置，但这里确认一下
CONFIG_KERNEL_NF_TABLES=y
CONFIG_KERNEL_NF_TABLES_INET=y
CONFIG_KERNEL_NF_TABLES_NETDEV=y
CONFIG_KERNEL_NF_TABLES_IPV4=y
CONFIG_KERNEL_NF_TABLES_IPV6=y
CONFIG_KERNEL_NF_TABLES_ARP=y
CONFIG_KERNEL_NF_TABLES_BRIDGE=y
CONFIG_KERNEL_NF_CONNTRACK=y
CONFIG_KERNEL_NF_NAT=y

# --- 14. MTD工具（刷机/分区有用） ---
CONFIG_PACKAGE_kmod-mtd-rw=y
CONFIG_PACKAGE_mtd-utils=y
CONFIG_PACKAGE_mtd-utils-ubi=y
